# .env
# Docker 镜像加速（建议按需替换）
# 常见可选值：docker.m.daocloud.io | dockerproxy.com | mirror.ccs.tencentyun.com | docker.1ms.run
REGISTRY_MIRROR=docker.m.daocloud.io
APT_MIRROR_BASE=https://mirrors.tuna.tsinghua.edu.cn
PIP_INDEX_URL=https://mirrors.cloud.tencent.com/pypi/simple
PIP_EXTRA_INDEX_URL=
PIP_TIMEOUT=1200
ETCD_DATA_VOLUME=etcd_data_bge_m3
MILVUS_DATA_VOLUME=milvus_data_bge_m3

# ============ 数据库配置 ============
DATABASE_URL=postgresql://admin:secure_password_2024@postgres:5432/knowledge_base

# ============ Milvus配置 ============
MILVUS_HOST=milvus
MILVUS_PORT=19530
MILVUS_COLLECTION=knowledge_base_bge_m3

# ============ Redis配置 ============
REDIS_URL=redis://redis:6379

# ============ Celery配置 ============
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# ============ Ollama配置 ============
# 说明：默认按“外部 Ollama”配置（Docker Desktop 内可用 `host.docker.internal` 访问宿主机）。
# 如需使用 compose 内置 Ollama：运行 `docker compose --profile with-ollama up -d`，并把 OLLAMA_BASE_URL 改回 `http://ollama:11434`。
# 首次使用模型前请确保已下载：`ollama pull qwen2.5:32b`
OLLAMA_BASE_URL=http://host.docker.internal:11434
OLLAMA_MODEL=qwen2.5:32b
OLLAMA_TEMPERATURE=0.7
OLLAMA_EMBEDDING_MODEL=bge-large:latest

# ============ 可选推理后端（OpenAI 兼容）===========
# vLLM：需要提供 OpenAI 兼容的 /v1/chat/completions
VLLM_BASE_URL=
VLLM_API_KEY=
# Xinference：需要提供 OpenAI 兼容的 /v1/chat/completions（以及可选 /v1/rerank）
XINFERENCE_BASE_URL=http://host.docker.internal:9998
XINFERENCE_API_KEY=

# ============ MinIO配置 ============
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=knowledge-base
MINIO_USE_SSL=false

# ============ 应用配置 ============
APP_NAME=Knowledge Base Management System
DEBUG=False
LOG_LEVEL=INFO
CORS_ORIGINS=["*"]

# ============ 文档处理配置 ============
CHUNK_SIZE=512
CHUNK_OVERLAP=50
MAX_FILE_SIZE=52428800

# ============ 向量模型配置 ============
EMBEDDING_PROVIDER=ollama
EMBEDDING_MODEL=bge-large:latest
EMBEDDING_DIMENSION=1024

# ============ 鉴权配置 ============
JWT_SECRET=change-me
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=1440

ADMIN_USERNAME=admin
ADMIN_PASSWORD=change-me

# ============ PDF OCR（扫描件）===========
# 默认：当 PDF 文本提取几乎为空时，自动尝试 OCR（Tesseract）并把结果写入 Markdown。
OCR_ENABLED=true
OCR_LANG=chi_sim+eng
OCR_DPI=200
OCR_MIN_CHARS=50
OCR_MAX_PAGES=0

# ============ MinerU / magic-pdf（可选）===========
# 说明：magic-pdf 完整版依赖较重（torch/ultralytics/unimernet 等），若未完整安装会自动降级。
# 默认开启（优先用 MinerU/magic-pdf 解析 PDF）；若缺依赖/模型下载失败，会自动降级到常规解析 + OCR。
MINERU_USE_MAGIC_PDF=true
